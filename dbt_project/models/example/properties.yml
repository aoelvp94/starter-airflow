version: 2

sources:
  - name: source_data
    schema: restack_demo
    tables:
      - name: time_series_daily
        description: stocks data per day
        tests:
          - dbt_utils.unique_combination_of_columns:
              combination_of_columns:
                - date
                - symbol
        columns:
          - name: _2__high
            tests:
              - not_null
          - name: _3__low
            tests:
              - not_null
          - name: _5__volume
            tests:
              - not_null
models:
  - name: obtain_all_currency
    description: stock data with currency conversion
    config:
      materialized: table
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - symbol
            - avg_price_at_currency
            - avg_num_trades
            - currency_code
            - processing_date
            - ingestion_date
    columns:
      - name: symbol
        tests:
          - not_null
      - name: avg_price_at_currency
        tests:
          - not_null
      - name: avg_num_trades
        tests:
          - not_null
      - name: currency_code
        tests:
          - not_null
      - name: ingestion_date
        tests:
          - not_null
      - name: processing_date
        tests:
          - not_null